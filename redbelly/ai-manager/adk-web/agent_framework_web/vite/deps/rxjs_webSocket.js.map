{
  "version": 3,
  "sources": ["../../../../../../node_modules/rxjs/dist/esm5/internal/observable/dom/WebSocketSubject.js", "../../../../../../node_modules/rxjs/dist/esm5/internal/observable/dom/webSocket.js"],
  "sourcesContent": ["import { __assign, __extends } from \"tslib\";\nimport { Subject, AnonymousSubject } from '../../Subject';\nimport { Subscriber } from '../../Subscriber';\nimport { Observable } from '../../Observable';\nimport { Subscription } from '../../Subscription';\nimport { ReplaySubject } from '../../ReplaySubject';\nvar DEFAULT_WEBSOCKET_CONFIG = {\n  url: '',\n  deserializer: function (e) {\n    return JSON.parse(e.data);\n  },\n  serializer: function (value) {\n    return JSON.stringify(value);\n  }\n};\nvar WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT = 'WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }';\nvar WebSocketSubject = function (_super) {\n  __extends(WebSocketSubject, _super);\n  function WebSocketSubject(urlConfigOrSource, destination) {\n    var _this = _super.call(this) || this;\n    _this._socket = null;\n    if (urlConfigOrSource instanceof Observable) {\n      _this.destination = destination;\n      _this.source = urlConfigOrSource;\n    } else {\n      var config = _this._config = __assign({}, DEFAULT_WEBSOCKET_CONFIG);\n      _this._output = new Subject();\n      if (typeof urlConfigOrSource === 'string') {\n        config.url = urlConfigOrSource;\n      } else {\n        for (var key in urlConfigOrSource) {\n          if (urlConfigOrSource.hasOwnProperty(key)) {\n            config[key] = urlConfigOrSource[key];\n          }\n        }\n      }\n      if (!config.WebSocketCtor && WebSocket) {\n        config.WebSocketCtor = WebSocket;\n      } else if (!config.WebSocketCtor) {\n        throw new Error('no WebSocket constructor can be found');\n      }\n      _this.destination = new ReplaySubject();\n    }\n    return _this;\n  }\n  WebSocketSubject.prototype.lift = function (operator) {\n    var sock = new WebSocketSubject(this._config, this.destination);\n    sock.operator = operator;\n    sock.source = this;\n    return sock;\n  };\n  WebSocketSubject.prototype._resetState = function () {\n    this._socket = null;\n    if (!this.source) {\n      this.destination = new ReplaySubject();\n    }\n    this._output = new Subject();\n  };\n  WebSocketSubject.prototype.multiplex = function (subMsg, unsubMsg, messageFilter) {\n    var self = this;\n    return new Observable(function (observer) {\n      try {\n        self.next(subMsg());\n      } catch (err) {\n        observer.error(err);\n      }\n      var subscription = self.subscribe({\n        next: function (x) {\n          try {\n            if (messageFilter(x)) {\n              observer.next(x);\n            }\n          } catch (err) {\n            observer.error(err);\n          }\n        },\n        error: function (err) {\n          return observer.error(err);\n        },\n        complete: function () {\n          return observer.complete();\n        }\n      });\n      return function () {\n        try {\n          self.next(unsubMsg());\n        } catch (err) {\n          observer.error(err);\n        }\n        subscription.unsubscribe();\n      };\n    });\n  };\n  WebSocketSubject.prototype._connectSocket = function () {\n    var _this = this;\n    var _a = this._config,\n      WebSocketCtor = _a.WebSocketCtor,\n      protocol = _a.protocol,\n      url = _a.url,\n      binaryType = _a.binaryType;\n    var observer = this._output;\n    var socket = null;\n    try {\n      socket = protocol ? new WebSocketCtor(url, protocol) : new WebSocketCtor(url);\n      this._socket = socket;\n      if (binaryType) {\n        this._socket.binaryType = binaryType;\n      }\n    } catch (e) {\n      observer.error(e);\n      return;\n    }\n    var subscription = new Subscription(function () {\n      _this._socket = null;\n      if (socket && socket.readyState === 1) {\n        socket.close();\n      }\n    });\n    socket.onopen = function (evt) {\n      var _socket = _this._socket;\n      if (!_socket) {\n        socket.close();\n        _this._resetState();\n        return;\n      }\n      var openObserver = _this._config.openObserver;\n      if (openObserver) {\n        openObserver.next(evt);\n      }\n      var queue = _this.destination;\n      _this.destination = Subscriber.create(function (x) {\n        if (socket.readyState === 1) {\n          try {\n            var serializer = _this._config.serializer;\n            socket.send(serializer(x));\n          } catch (e) {\n            _this.destination.error(e);\n          }\n        }\n      }, function (err) {\n        var closingObserver = _this._config.closingObserver;\n        if (closingObserver) {\n          closingObserver.next(undefined);\n        }\n        if (err && err.code) {\n          socket.close(err.code, err.reason);\n        } else {\n          observer.error(new TypeError(WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT));\n        }\n        _this._resetState();\n      }, function () {\n        var closingObserver = _this._config.closingObserver;\n        if (closingObserver) {\n          closingObserver.next(undefined);\n        }\n        socket.close();\n        _this._resetState();\n      });\n      if (queue && queue instanceof ReplaySubject) {\n        subscription.add(queue.subscribe(_this.destination));\n      }\n    };\n    socket.onerror = function (e) {\n      _this._resetState();\n      observer.error(e);\n    };\n    socket.onclose = function (e) {\n      if (socket === _this._socket) {\n        _this._resetState();\n      }\n      var closeObserver = _this._config.closeObserver;\n      if (closeObserver) {\n        closeObserver.next(e);\n      }\n      if (e.wasClean) {\n        observer.complete();\n      } else {\n        observer.error(e);\n      }\n    };\n    socket.onmessage = function (e) {\n      try {\n        var deserializer = _this._config.deserializer;\n        observer.next(deserializer(e));\n      } catch (err) {\n        observer.error(err);\n      }\n    };\n  };\n  WebSocketSubject.prototype._subscribe = function (subscriber) {\n    var _this = this;\n    var source = this.source;\n    if (source) {\n      return source.subscribe(subscriber);\n    }\n    if (!this._socket) {\n      this._connectSocket();\n    }\n    this._output.subscribe(subscriber);\n    subscriber.add(function () {\n      var _socket = _this._socket;\n      if (_this._output.observers.length === 0) {\n        if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n          _socket.close();\n        }\n        _this._resetState();\n      }\n    });\n    return subscriber;\n  };\n  WebSocketSubject.prototype.unsubscribe = function () {\n    var _socket = this._socket;\n    if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n      _socket.close();\n    }\n    this._resetState();\n    _super.prototype.unsubscribe.call(this);\n  };\n  return WebSocketSubject;\n}(AnonymousSubject);\nexport { WebSocketSubject };\n", "import { WebSocketSubject } from './WebSocketSubject';\nexport function webSocket(urlConfigOrSource) {\n  return new WebSocketSubject(urlConfigOrSource);\n}\n"],
  "mappings": "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",
  "names": ["WebSocketSubject"]
}
