# Wallet Creation and Funding Guide

This guide explains how to create and fund wallets on the Midnight development chain.

## Midnight Token Model

| Token | Description | Transferable | Use Case |
|-------|-------------|--------------|----------|
| **NIGHT** | Native token on Midnight | Yes | Value transfer, DUST generation |
| **Shielded NIGHT** | Private NIGHT using ZK proofs | Yes | Private transactions, confidential balances |
| **Unshielded NIGHT** | Public NIGHT visible on-chain | Yes | General transfers, public balances |
| **DUST** | Fee resource (regenerates over time) | **No** | Transaction fees only |

> **Key Distinction:** NIGHT is the native token that can exist in shielded (private) or unshielded (public) form. DUST is a non-transferable resource used exclusively for transaction fees that regenerates based on NIGHT holdings.

---

## For Users

### Create a Wallet

```bash
midnightctl wallet create my-wallet
```

This generates a BIP39 mnemonic and derives the wallet. **Store the mnemonic securely!**

### Check Balance

```bash
# Show shielded + unshielded NIGHT balances
midnightctl wallet balance my-wallet

# Include DUST resource status
midnightctl wallet balance my-wallet --include-dust
```

### Get Wallet Addresses

```bash
# Show basic addresses
midnightctl wallet address my-wallet

# Show all addresses including DUST
midnightctl wallet address my-wallet --all
```

### Fund from Genesis (Local Dev Only)

In standalone mode, you can fund your wallet from a pre-funded genesis wallet:

```bash
midnightctl wallet fund my-wallet 10000
```

### Send NIGHT Tokens

The CLI auto-detects address type and routes accordingly:

```bash
# Send to shielded address (private transfer)
midnightctl wallet send my-wallet mn_shield-addr_standalone1... 100

# Send to unshielded address (public transfer)
midnightctl wallet send my-wallet mn_addr_standalone1... 100
```

### Register for DUST Generation

DUST is required for transaction fees. Register your wallet to start generating DUST:

```bash
midnightctl wallet register-dust my-wallet
```

---

## For Developers

### Wallet Seed Formats

The Midnight platform supports two seed formats:

| Format | Description | Example |
|--------|-------------|---------|
| **BIP39 Mnemonic** | 12-24 word phrase | `abandon ability able about above absent...` |
| **Hex Seed** | 64 or 128 character hex string | `0000...0001` (64 chars) |

**Mnemonic (Recommended):**
- Standard BIP39 format (12, 15, 18, 21, or 24 words)
- Human-readable and easier to backup
- Generated by `midnightctl wallet create`

**Hex Seed:**
- 64 characters (32 bytes) - compact format
- 128 characters (64 bytes) - extended format
- Used by genesis wallets and advanced tooling

### Pre-Funded Genesis Wallets

In standalone mode (`CFG_PRESET=dev`), these wallets are pre-funded for development:

| Wallet | Seed (64-character hex) |
|--------|-------------------------|
| Genesis 1 | `0000000000000000000000000000000000000000000000000000000000000001` |
| Genesis 2 | `0000000000000000000000000000000000000000000000000000000000000002` |
| Genesis 3 | `0000000000000000000000000000000000000000000000000000000000000003` |
| Genesis 4 | `0000000000000000000000000000000000000000000000000000000000000004` |

These can be used for funding new wallets during local development.

### Address Types

Midnight uses three address types, each for a different purpose:

| Address Type | Prefix | Purpose |
|--------------|--------|---------|
| **Unshielded** | `mn_addr_...` | Public NIGHT transfers |
| **Shielded** | `mn_shield-addr_...` | Private NIGHT transfers (ZK) |
| **DUST** | `mn_dust-addr_...` | DUST registration only |

### Wallet Architecture (SDK 3.x)

The CLI uses the Midnight SDK 3.x wallet architecture internally:

- **HD Wallet**: Hierarchical deterministic key derivation from seed
- **ZswapWallet**: Manages shielded balances using zero-knowledge proofs
- **UnshieldedWallet**: Manages public/unshielded balances
- **DustWallet**: Manages DUST resource for transaction fees
- **WalletFacade**: Unified interface combining all wallet types

For implementation details, see:
- `cli/src/lib/midnight/providers.ts` - Wallet creation and provider setup
- `cli/src/lib/midnight/seed.ts` - Seed parsing utilities
- `vendor/README.md` - SDK 3.x architecture documentation

---

## Troubleshooting

### "Connection refused" Error

Ensure the node is running:
```bash
curl -s http://localhost:9944/health
```

Or check GKE services:
```bash
midnightctl services status
```

### "Empty UTXOs" Error

The wallet may not be funded. Use a genesis wallet or wait for pending transactions.

### "Insufficient DUST" Error

Register for DUST generation and wait for regeneration:
```bash
midnightctl wallet register-dust my-wallet
```

DUST regenerates over time based on your NIGHT holdings.

### Wallet Sync Timeout

If wallet sync takes too long, check the indexer status:
```bash
midnightctl services logs indexer
```

---

## Additional Resources

- [Midnight Network Documentation](https://docs.midnight.network/)
- [NIGHT Token Info](https://midnight.network/night)
- [SDK Architecture](vendor/README.md)
